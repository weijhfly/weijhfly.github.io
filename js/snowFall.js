var SCREEN_WIDTH=window.innerWidth;var SCREEN_HEIGHT=window.innerHeight;var container;var particle;var camera;var scene;var renderer;var mouseX=0;var mouseY=0;var particleY_Range=0;var particleX_Range=0;var wind_weight=0;var windowHalfX=SCREEN_WIDTH/2;var windowHalfY=SCREEN_HEIGHT/2;var particles=[];var js=document.scripts;var path=js[js.length-1].src.substring(0,js[js.length-1].src.lastIndexOf("/"));var imageSrc=path.substring(0,path.lastIndexOf("/")+1)+"images/ParticleSmoke.png";var particleImage=new Image();particleImage.src=imageSrc;function onDocumentMouseMove(event){mouseX=event.clientX-windowHalfX;mouseY=event.clientY-particleY_Range/2}function onDocumentTouchStart(event){if(event.touches.length==1){event.preventDefault();mouseX=event.touches[0].pageX-windowHalfX;mouseY=event.touches[0].pageY-particleY_Range/2}}function onDocumentTouchMove(event){if(event.touches.length==1){event.preventDefault();mouseX=event.touches[0].pageX-windowHalfX;mouseY=event.touches[0].pageY-particleY_Range/2}}function loop(){for(var i=0;i<particles.length;i++){var particle=particles[i];particle.updatePhysics();with(particle.position){if(y<-particleY_Range/2){y+=particleY_Range}if(x>windowHalfX){x-=SCREEN_WIDTH}else{if(x<-windowHalfX){x+=SCREEN_WIDTH}}x+=wind_weight}}camera.position.x+=(mouseX-camera.position.x)*0.05;camera.position.y+=(-mouseY-camera.position.y)*0.05;camera.lookAt(scene.position);renderer.render(scene,camera)}jQuery.extend({snowFall:function(options){var defaults={particleNo:500,particleSpeed:15,particleY_Range:1300,particleX_Range:1000,bindMouse:false,zIndex:600,wind_weight:0,angle:55};var opts=$.extend(defaults,options);particleY_Range=opts.particleY_Range;particleX_Range=opts.particleX_Range;wind_weight=opts.wind_weight;container=document.createElement("div");document.body.appendChild(container);camera=new THREE.PerspectiveCamera(opts.angle,SCREEN_WIDTH/SCREEN_HEIGHT,1,10000);camera.position.z=opts.zIndex;scene=new THREE.Scene();scene.add(camera);renderer=new THREE.CanvasRenderer();renderer.setSize(SCREEN_WIDTH,SCREEN_HEIGHT);var material=new THREE.ParticleBasicMaterial({map:new THREE.Texture(particleImage)});window.addEventListener("onorientationchange" in window?"orientationchange":"resize",function(){renderer.setSize($(window).width(),$(window).height())});for(var i=0;i<opts.particleNo;i++){particle=new Particle3D(material);particle.position.x=Math.random()*SCREEN_WIDTH-windowHalfX;particle.position.y=Math.random()*SCREEN_HEIGHT*2-SCREEN_HEIGHT;particle.position.z=Math.random()*opts.zIndex*4-opts.zIndex*2;particle.scale.x=particle.scale.y=1;scene.add(particle);particles.push(particle)}container.appendChild(renderer.domElement);if(opts.bindMouse){document.addEventListener("mousemove",onDocumentMouseMove,false);document.addEventListener("touchstart",onDocumentTouchStart,false);document.addEventListener("touchmove",onDocumentTouchMove,false)}setInterval(loop,opts.particleSpeed)}});